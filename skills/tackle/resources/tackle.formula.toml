description = """
Upstream-aware issue implementation workflow with approval gates.

Tracks work from initial research through PR submission. Each step is a
checkpoint that survives session restarts. Gates require explicit approval.

**REQUIRED:** Run `/tackle --resume` after compaction or new session to load full guidance.

Usage: gt sling tackle --on <issue-bead>

Context is read from the bonded bead:
- Issue ID: gt hook --json | jq -r '.bead_id'
- Upstream: stored in bead notes before slinging (grep 'upstream:')
"""
formula = "tackle"
version = 4

[[steps]]
id = "plan"
title = "Create implementation plan"
description = """
**REQUIRED:** Run `/tackle --resume plan` for full guidance.

Create implementation plan based on:
- Issue requirements
- Upstream context (patterns, conventions)
- Hot areas to avoid
"""

[[steps]]
id = "gate-plan"
title = "GATE: Plan approval"
needs = ["plan"]
description = """
**MANDATORY STOP**

Present plan to user. Wait for explicit approval.
DO NOT PROCEED WITHOUT APPROVAL.

**REQUIRED:** Run `/tackle --resume gate-plan` for gate protocol.
"""

[[steps]]
id = "branch"
title = "Create clean branch"
needs = ["gate-plan"]
description = """
**REQUIRED:** Run `/tackle --resume branch` for full guidance.
"""

[[steps]]
id = "implement"
title = "Implement solution"
needs = ["branch"]
description = """
**REQUIRED:** Run `/tackle --resume implement` for full guidance.

Implement following upstream conventions.
Commit atomically with conventional commit messages.
"""

[[steps]]
id = "validate"
title = "Validate implementation"
needs = ["implement"]
description = """
**REQUIRED:** Run `/tackle --resume validate` for full guidance.

- Run tests
- Check isolation (single concern)
- Verify branch is rebased on upstream
"""

[[steps]]
id = "gate-submit"
title = "GATE: Pre-submit approval"
needs = ["validate"]
description = """
**MANDATORY STOP**

On entering this gate:
1. Check if draft PR already exists (idempotent)
2. If not, create draft PR on upstream
3. Present for review

Show full PR preview:
- Draft PR URL on upstream
- Title, body, files changed
- Validation results

Wait for explicit approval.
DO NOT MARK PR READY WITHOUT APPROVAL.

**REQUIRED:** Run `/tackle --resume gate-submit` for gate protocol.
"""

[[steps]]
id = "submit"
title = "Submit PR"
needs = ["gate-submit"]
description = """
**REQUIRED:** Run `/tackle --resume submit` for full guidance.

Only after explicit approval:
1. Mark draft PR as ready for review: gh pr ready
2. Verify PR is no longer in draft state
"""

[[steps]]
id = "record"
title = "Record outcome"
needs = ["submit"]
description = """
**REQUIRED:** Run `/tackle --resume record` for full guidance.

Track PR URL and outcome for future learning.
Update local issue with PR link.
"""

[[steps]]
id = "reflect"
title = "Reflect"
needs = ["record"]
description = """
**REQUIRED:** Run `/tackle --resume reflect` for full guidance.

Reflect on issues tackle could help prevent in future runs.

**Fix immediately**: Objective errors (wrong flags, syntax errors).
**Note for pattern detection**: Subjective friction via molecule history.

Ignore task-specific issues (test failures, upstream quirks).
"""
