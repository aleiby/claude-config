description = """
Upstream-aware issue implementation workflow with approval gates.

Tracks work from initial research through PR submission. Each step is a
checkpoint that survives session restarts. Gates require explicit approval.
"""
formula = "tackle"
version = 2

[vars.issue]
description = "The issue ID being tackled"
required = true

[vars.upstream]
description = "Detected upstream org/repo"
required = false

[[steps]]
id = "plan"
title = "Create implementation plan"
description = """
See <skill-dir>/resources/IMPLEMENT.md Plan Phase.

Create implementation plan based on:
- Issue requirements
- Upstream context (patterns, conventions)
- Hot areas to avoid
"""

[[steps]]
id = "gate-plan"
title = "GATE: Plan approval"
needs = ["plan"]
description = """
**MANDATORY STOP**

Present plan to user. Wait for explicit approval.
DO NOT PROCEED WITHOUT APPROVAL.
See <skill-dir>/SKILL.md gate-plan section.
"""

[[steps]]
id = "branch"
title = "Create clean branch"
needs = ["gate-plan"]
description = """
See <skill-dir>/resources/IMPLEMENT.md Branch Phase.

git fetch $UPSTREAM_REMOTE
git checkout -b <type>/<issue-id>-<description> $UPSTREAM_REF

Variables from <skill-dir>/SKILL.md "Detect Upstream" section.
"""

[[steps]]
id = "implement"
title = "Implement solution"
needs = ["branch"]
description = """
See <skill-dir>/resources/IMPLEMENT.md Implement Phase.

Implement following upstream conventions.
Commit atomically with conventional commit messages.
"""

[[steps]]
id = "validate"
title = "Validate implementation"
needs = ["implement"]
description = """
See <skill-dir>/resources/VALIDATION.md.

- Run tests
- Check isolation (single concern)
- Verify branch is rebased on upstream
"""

[[steps]]
id = "gate-submit"
title = "GATE: Pre-submit approval"
needs = ["validate"]
description = """
**MANDATORY STOP**

On entering this gate:
1. Check if draft PR already exists (idempotent)
2. If not, create draft PR on upstream
3. Present for review

Show full PR preview:
- Draft PR URL on upstream
- Title, body, files changed
- Validation results

Wait for explicit approval.
DO NOT MARK PR READY WITHOUT APPROVAL.
See <skill-dir>/SKILL.md gate-submit section.
"""

[[steps]]
id = "submit"
title = "Submit PR"
needs = ["gate-submit"]
description = """
See <skill-dir>/resources/SUBMIT.md.

Only after explicit approval:
1. Mark draft PR as ready for review: gh pr ready
2. Verify PR is no longer in draft state
"""

[[steps]]
id = "record"
title = "Record outcome"
needs = ["submit"]
description = """
See <skill-dir>/resources/SUBMIT.md Record Phase.

Track PR URL and outcome for future learning.
Update local issue with PR link.
"""

[[steps]]
id = "reflect"
title = "Reflect"
needs = ["record"]
description = """
See <skill-dir>/resources/REFLECT.md.

Reflect on issues tackle could help prevent in future runs.

**Fix immediately**: Objective errors (wrong flags, syntax errors).
**Note for pattern detection**: Subjective friction via molecule history.

Ignore task-specific issues (test failures, upstream quirks).
"""
